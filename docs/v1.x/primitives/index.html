<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-v1.x/primitives" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0">
<title data-rh="true">MACI Primitives | MACI</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://maci.pse.dev/maci/img/maci-logo-2.png"><meta data-rh="true" name="twitter:image" content="https://maci.pse.dev/maci/img/maci-logo-2.png"><meta data-rh="true" property="og:url" content="https://maci.pse.dev/maci/docs/v1.x/primitives"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="MACI Primitives | MACI"><meta data-rh="true" name="description" content="A short introduction of the main primitives used by MACI"><meta data-rh="true" property="og:description" content="A short introduction of the main primitives used by MACI"><link data-rh="true" rel="icon" href="/maci/img/maci-logo-2.png"><link data-rh="true" rel="canonical" href="https://maci.pse.dev/maci/docs/v1.x/primitives"><link data-rh="true" rel="alternate" href="https://maci.pse.dev/maci/docs/v1.x/primitives" hreflang="en"><link data-rh="true" rel="alternate" href="https://maci.pse.dev/maci/docs/v1.x/primitives" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/maci/blog/rss.xml" title="MACI RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/maci/blog/atom.xml" title="MACI Atom Feed">




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/maci/assets/css/styles.dea21875.css">
<script src="/maci/assets/js/runtime~main.a6453e4f.js" defer="defer"></script>
<script src="/maci/assets/js/main.1df0c240.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/maci/"><b class="navbar__title text--truncate">MACI</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/maci/docs/v1.x/introduction">Documentation</a><a class="navbar__item navbar__link" href="/maci/blog">Blog</a></div><div class="navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div><a href="https://github.com/privacy-scaling-explorations/maci" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/maci/docs/v1.x/introduction">v1.x</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/maci/docs/v1.x/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/maci/docs/v1.x/primitives">Primitives</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/maci/docs/v1.x/installation">Installation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/maci/docs/v1.x/testing">Testing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/maci/docs/v1.x/trusted-setup">Trusted Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/maci/docs/v1.x/integrating">Integrating</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/maci/docs/v1.x/circuits">Circuits</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/maci/docs/v1.x/cli">Command-line interface</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/maci/docs/v1.x/audit">Latest Audit</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/maci/docs/v0.x/introduction">v0.x</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/maci/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">v1.x</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Primitives</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>MACI Primitives</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="maci-primitives">MACI primitives<a href="#maci-primitives" class="hash-link" aria-label="Direct link to MACI primitives" title="Direct link to MACI primitives">​</a></h2>
<p>This section provides a short introduction of the main primitives used by MACI.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="elliptic-curves">Elliptic Curves<a href="#elliptic-curves" class="hash-link" aria-label="Direct link to Elliptic Curves" title="Direct link to Elliptic Curves">​</a></h3>
<p>MACI uses the Baby Jubjub Elliptic <a href="https://iden3-docs.readthedocs.io/en/latest/_downloads/33717d75ab84e11313cc0d8a090b636f/Baby-Jubjub.pdf" target="_blank" rel="noopener noreferrer">Curve</a>. The <code>p</code> scalar field of choosing is:</p>
<p><code class="language-math math-inline">p=21888242871839275222246405745257275088548364400416034343698204186575808495617</code></p>
<p>with generator:</p>
<p><code class="language-math math-inline">995203441582195749578291179787384436505546430278305826713579947235728471134</code>
<code class="language-math math-inline">5472060717959818805561601436314318772137091100104008585924551046643952123905</code></p>
<p>and within the finite field with modulo <code class="language-math math-inline">p</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="key-pairs">Key Pairs<a href="#key-pairs" class="hash-link" aria-label="Direct link to Key Pairs" title="Direct link to Key Pairs">​</a></h3>
<p>MACI uses Node.js&#x27;s <code>crypto.randomBytes(32)</code> function to generate a cryptographically strong pseudorandom 32-byte value, as well as an algorithm to prevent modulo bias. In pseudocode this is:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">lim = 2 ** 256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">min = lim - p</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rand = null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">while true:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rand = BigInt(crypto.getRandomBytes(32))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if rand &gt;= min:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        break</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">privKey = rand % p</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>A public key is a point on the Baby Jubjub <a href="https://iden3-docs.readthedocs.io/en/latest/_downloads/33717d75ab84e11313cc0d8a090b636f/Baby-Jubjub.pdf" target="_blank" rel="noopener noreferrer">curve</a>, which is deterministically derived from a private key <code>s</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="message-signing">Message Signing<a href="#message-signing" class="hash-link" aria-label="Direct link to Message Signing" title="Direct link to Message Signing">​</a></h3>
<p>To sign messages, MACI uses the Edwards-curve Digital Signature Algorithm (EdDSA), implemented by <a href="https://iden3-docs.readthedocs.io/en/latest/iden3_repos/research/publications/zkproof-standards-workshop-2/ed-dsa/ed-dsa.html#ed-dsa" target="_blank" rel="noopener noreferrer">iden3</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="hash-functions">Hash Functions<a href="#hash-functions" class="hash-link" aria-label="Direct link to Hash Functions" title="Direct link to Hash Functions">​</a></h3>
<p>MACI uses the Poseidon hash function, which is proven to be very efficient in ZK applications. Poseidon accepts <code class="language-math math-inline">n</code> inputs and produces 1 output:</p>
<p><code class="language-math math-inline">y = poseidon_n([x_1, x_2, ..., x_n])</code></p>
<p>Also, SHA256 is used to compress public inputs to a circuit into a single field element in the finite field <code class="language-math math-inline">F</code> mod <code class="language-math math-inline">p</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="message-encryption">Message Encryption<a href="#message-encryption" class="hash-link" aria-label="Direct link to Message Encryption" title="Direct link to Message Encryption">​</a></h3>
<p>In order to encrypt messages, MACI uses Poseidon in DuplexSponge <a href="https://dusk.network/uploads/Encryption-with-Poseidon.pdf" target="_blank" rel="noopener noreferrer">mode</a>. This provides an encryption function and a decryption function:</p>
<ul>
<li><code class="language-math math-inline">C</code> as <code class="language-math math-inline">poseidonEncrypt(k_s[0], k_s[1], N, l, t[])</code></li>
<li><code class="language-math math-inline">poseidonDecrypt(k_s[0], k_s[1], N, l, C)</code> --&gt;</li>
</ul>
<p>In more details,</p>
<ul>
<li><code class="language-math math-inline">k_s</code> is the shared key, a point on the Baby Jubjub curve</li>
<li><code class="language-math math-inline">N</code> is the nonce, which we hardcode to 0</li>
<li><code class="language-math math-inline">l</code> is the length of the plaintext <code class="language-math math-inline">t[]</code></li>
</ul>
<p>The implementation can be found <a href="https://github.com/weijiekoh/circomlib/" target="_blank" rel="noopener noreferrer">here</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="shared-key-generation">Shared Key Generation<a href="#shared-key-generation" class="hash-link" aria-label="Direct link to Shared Key Generation" title="Direct link to Shared Key Generation">​</a></h3>
<p>The ECDH algorithm is used to generate a shared key, which is then used to encrypt each message. This allows to create messages which are only decryptable by the coordinator and the person sending the message.</p>
<p>In more details:</p>
<ul>
<li>
<p>The coordinator&#x27;s public key <code class="language-math math-inline">cPk</code> is known to all. Their private key <code class="language-math math-inline">cSk</code> is secret.</p>
</li>
<li>
<p>When the user publishes a message (i.e. casts a vote), they generate an ephemeral keypair with private key <code class="language-math math-inline">eSk</code> and public key <code class="language-math math-inline">ePk</code>.</p>
</li>
<li>
<p>The user generates the shared key <code class="language-math math-inline">k</code> using the coordinator&#x27;s public key <code class="language-math math-inline">cPk</code> and the user&#x27;s ephemeral private key <code class="language-math math-inline">eSk</code>.</p>
</li>
<li>
<p>The user encrypts the command and signature with <code class="language-math math-inline">k</code> to form a message.</p>
</li>
<li>
<p>The user sends their ephemeral public key <code class="language-math math-inline">ePk</code> along with the ciphertext. The coordinator can recover the same shared key using their private key <code class="language-math math-inline">cSk</code> and the given ephemeral public key <code class="language-math math-inline">ePk</code>.</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="merkle-trees">Merkle Trees<a href="#merkle-trees" class="hash-link" aria-label="Direct link to Merkle Trees" title="Direct link to Merkle Trees">​</a></h3>
<p>Rather than using Binary merkle trees, MACI uses Quinary merkle trees (5 leaves per node). This allows for more gas efficient computation using the Poseidon hash function.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="accumulator-queue">Accumulator queue<a href="#accumulator-queue" class="hash-link" aria-label="Direct link to Accumulator queue" title="Direct link to Accumulator queue">​</a></h4>
<p>This contract holds user sign-ups and messages. When a leaf is inserted into the <code>AccQueue</code>, the merkle root is not updated yet, instead the leaf is updated or the root of a subtree is re-computed. The smart contract exposes three functions:</p>
<ul>
<li><code>enqueue(leaf)</code>: Enqueues a leaf into a subtree
four out of five times it is invoked, an enqueue operation may or may not require the contract to perform a hash function. When it does, only up to <code class="language-math math-inline">t_d</code> required number of hashes need to be computed</li>
<li><code>mergeSubRoots()</code>: Merge all subtree roots into the shortest possible Merkle tree to fit
Before computing the main Merkle root, it is necessary to compute the smallSRTroot (the smallest subroot tree root). This is the Merkle root of a tree which is small enough to fit all the subroots
function which allows the coordinator to specify the number of queue operations to execute. The entire tree may be merged in a single transaction, or it may not.</li>
<li><code>merge()</code>: Calculate the Merkle root of all the leaves at height <code class="language-math math-inline">d_t</code></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="domain-objects">Domain Objects<a href="#domain-objects" class="hash-link" aria-label="Direct link to Domain Objects" title="Direct link to Domain Objects">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="verifying-keys">Verifying Keys<a href="#verifying-keys" class="hash-link" aria-label="Direct link to Verifying Keys" title="Direct link to Verifying Keys">​</a></h4>
<p>A verifying key <code class="language-math math-inline">vk</code> is comprised of the following elements:</p>
<ol>
<li><code class="language-math math-inline">\alpha</code>, a point in the curve on which <code class="language-math math-inline">G_1</code> is defined</li>
<li><code class="language-math math-inline">\beta</code>, a point in the curve on which <code class="language-math math-inline">G_2</code> is defined</li>
<li><code class="language-math math-inline">\gamma</code>, a point in the curve on which <code class="language-math math-inline">G_2</code> is defined</li>
<li><code class="language-math math-inline">\delta</code>, a point in the curve on which <code class="language-math math-inline">G_2</code> is defined</li>
<li><code class="language-math math-inline">ic[]</code>, a list of points in the curve on which <code class="language-math math-inline">G_1</code> is defined</li>
</ol>
<p>A verifying key is used to validate a zk-SNARK proof. Each unique permutation of parameters to a particular circuit has a different verifying key.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="private-keys">Private Keys<a href="#private-keys" class="hash-link" aria-label="Direct link to Private Keys" title="Direct link to Private Keys">​</a></h4>
<p>MACI&#x27;s private keys allow users to send and decrypt messages. This key translates to a scalar point on the Baby Jubjub ellpitic curve. All keys are serialized with the prefix <code>macisk</code>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="public-keys">Public Keys<a href="#public-keys" class="hash-link" aria-label="Direct link to Public Keys" title="Direct link to Public Keys">​</a></h4>
<p>Public keys also translate to a point on the Baby Jubjub elliptic curve, and is derived from the private key <code class="language-math math-inline">k</code>. These are serialized with the prefix <code>macipk</code>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="key-pair">Key Pair<a href="#key-pair" class="hash-link" aria-label="Direct link to Key Pair" title="Direct link to Key Pair">​</a></h4>
<p>A Key Pair is a private key and its corresponding public key.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="command">Command<a href="#command" class="hash-link" aria-label="Direct link to Command" title="Direct link to Command">​</a></h4>
<p>A command represents an action that a user may take. Such as casting a vote in a poll or changing their public key if bribed. It is made up of the following parameters:</p>
<table><thead><tr><th>Symbol</th><th>Name</th><th>Size</th><th>Description</th></tr></thead><tbody><tr><td><code class="language-math math-inline">cm_i</code></td><td>State index</td><td>50</td><td>State leaf index where the signing key is located</td></tr><tr><td><code class="language-math math-inline">cm_{p_{x}}</code></td><td>Public key x-coordinate</td><td>253</td><td>If no change is necessary this parameter should reflect the current public key&#x27;s x-coordinate</td></tr><tr><td><code class="language-math math-inline">cm_{p_{y}}</code></td><td>Public key y-coordinate</td><td>253</td><td>If no change is necessary this parameter should reflect the current public key&#x27;s y-coordinate</td></tr><tr><td><code class="language-math math-inline">cm_{i_{v}}</code></td><td>Vote option index</td><td>50</td><td>Option state leaf index of preference to assign the vote for</td></tr><tr><td><code class="language-math math-inline">cm_w</code></td><td>Voting weight</td><td>50</td><td>Voice credit balance allocation, this is an arbitary value dependent on a user&#x27;s available credits</td></tr><tr><td><code class="language-math math-inline">cm_n</code></td><td>Nonce</td><td>50</td><td>State leaf&#x27;s index of actions committed plus one</td></tr><tr><td><code class="language-math math-inline">cm_{id}</code></td><td>Poll id</td><td>50</td><td>The poll&#x27;s identifier to cast in regard to</td></tr><tr><td><code class="language-math math-inline">cm_s</code></td><td>Salt</td><td>253</td><td>An entropy value to inhibit brute force attacks</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="message">Message<a href="#message" class="hash-link" aria-label="Direct link to Message" title="Direct link to Message">​</a></h4>
<p>A message is an encrypted command using the shared key <code class="language-math math-inline">k_s</code> between the voter and the coordinator. The plaintext <code class="language-math math-inline">t</code> is computed as such:</p>
<p><code class="language-math math-inline">t = [p, cm_{p_{x}}, cm_{p_{y}}, cm_s, R8[0], R8[1], S]</code></p>
<p>While the message can be computed with the formula below:</p>
<p><code class="language-math math-inline">M</code> = <code class="language-math math-inline">{poseidonEncrypt}(k_s[0], k_s[1], cm_n, 7, t)</code></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="decrypting-a-message">Decrypting a message<a href="#decrypting-a-message" class="hash-link" aria-label="Direct link to Decrypting a message" title="Direct link to Decrypting a message">​</a></h4>
<p>To decrypt a message using <code class="language-math math-inline">k_s</code> is expressed as</p>
<p><code class="language-math math-inline">[p, R8[0], R8[1], cm_s]</code> = <code class="language-math math-inline">{poseidonDecrypt}(M, k_s[0], k_s[1], cm_n, 7)</code></p>
<p>To unpack <code class="language-math math-inline">p</code> to it&#x27;s original five parameters, it must be seperated into 50 bit values from the parent 250 bit value. To extract 50 bits at byte <code class="language-math math-inline">n</code>, we:</p>
<ol>
<li>initialise 50 bits</li>
<li>shift left by <code class="language-math math-inline">n</code> bits</li>
<li>bitwise AND with <code class="language-math math-inline">p</code></li>
<li>shift right by <code class="language-math math-inline">n</code> bits</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ballot">Ballot<a href="#ballot" class="hash-link" aria-label="Direct link to Ballot" title="Direct link to Ballot">​</a></h3>
<p>A Ballot represents a particular user&#x27;s votes in a poll, as well as their next valid nonce. It is akin to a voting slip, which belongs to only one voter and contains a list of their choices.</p>
<table><thead><tr><th>Symbol</th><th>Name</th><th>Comments</th></tr></thead><tbody><tr><td><code class="language-math math-inline">blt_{v}</code></td><td>An array of vote weights</td><td><code class="language-math math-inline">blt_{v[i]}</code> refers to the vote weights assigned to vote option <code class="language-math math-inline">i</code></td></tr><tr><td><code class="language-math math-inline">blt_n</code></td><td>The current nonce</td><td>Starts from 0 and increments, so the first valid command must have nonce 1</td></tr><tr><td><code class="language-math math-inline">blt_d</code></td><td>The vote option tree depth</td><td></td></tr></tbody></table>
<p>The hash <code class="language-math math-inline">blt</code> is computed as such:</p>
<ol>
<li>Compute the Merkle root of <code class="language-math math-inline">blt_v</code>, arity 5, of a tree of depth <code class="language-math math-inline">blt_d</code>; let this value  be <code class="language-math math-inline">blt_r</code></li>
<li>Compute <code class="language-math math-inline">\{poseidon_2}([blt_n, blt_r])</code></li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="state-leaf">State leaf<a href="#state-leaf" class="hash-link" aria-label="Direct link to State leaf" title="Direct link to State leaf">​</a></h3>
<p>A state leaf represents a user&#x27;s participation declared through an identity (their public key) and information relevant to their ability or right to cast votes in a poll (their voice credit balance and the block timestamp at which they signed up).</p>
<p>We define a state leaf <code class="language-math math-inline">sl</code> as the <code class="language-math math-inline">\{poseidon_4}</code> hash of the following:</p>
<table><thead><tr><th>Symbol</th><th>Name</th><th>Comments</th></tr></thead><tbody><tr><td><code class="language-math math-inline">sl_{P_x}</code></td><td>Public key&#x27;s x-coordinate</td><td></td></tr><tr><td><code class="language-math math-inline">sl_{P_y}</code></td><td>Public key&#x27;s y-coordinate</td><td></td></tr><tr><td><code class="language-math math-inline">sl_{v}</code></td><td>Voice credit balance</td><td></td></tr><tr><td><code class="language-math math-inline">sl_{t}</code></td><td>Block timestamp</td><td>In Unix time (seconds since Jan 1 1970 UTC)</td></tr></tbody></table>
<p>The hash <code class="language-math math-inline">sl</code> is computed as such:</p>
<p><code class="language-math math-inline">sl = \{poseidon_4}([sl_{A_x}, sl_{A_y}, sl_{v}, sl_{t}])</code></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="blank-state-leaf">Blank state leaf<a href="#blank-state-leaf" class="hash-link" aria-label="Direct link to Blank state leaf" title="Direct link to Blank state leaf">​</a></h4>
<p>A blank state leaf <code class="language-math math-inline">sl_B</code> has the following value:</p>
<p><code class="language-math math-inline">6769006970205099520508948723718471724660867171122235270773600567925038008762</code></p>
<p>This value is computed as such:</p>
<p><code class="language-math math-inline">A_{b_x} = 10457101036533406547632367118273992217979173478358440826365724437999023779287</code>
<code class="language-math math-inline">A_{b_y} = 19824078218392094440610104313265183977899662750282163392862422243483260492317</code>
<code class="language-math math-inline">sl_B = \{poseidon_4}([A_{b0}, A_{b1}, 0, 0])</code></p>
<p>The code to derive <code class="language-math math-inline">A_{b_x}</code> and <code class="language-math math-inline">A_{b_y}</code> is <a href="https://github.com/iden3/circomlib/blob/d5ed1c3ce4ca137a6b3ca48bec4ac12c1b38957a/src/pedersen_printbases.js" target="_blank" rel="noopener noreferrer">here</a>. The function call required is <code>pedersenHash.getBasePoint(&#x27;blake&#x27;, 0)</code></p>
<ol>
<li>Hash the string <code>PedersenGenerator_00000000000000000000000000000000_00000000000000000000000000000000</code> with <code class="language-math math-inline">blake_{256}</code>. In big-endian hexadecimal format, the hash should be <code>1b3ef77ef2cd620fd2358e69dd564f35556aad552fdd7f06b777bd3a1d697160</code>.</li>
<li>Set the 255th bit to 0. The result should be <code>1b3ef77ef2cd620fd2358e69dd564f35556aad552fdd7f06b777bd3a1d697120</code>.</li>
<li>Use the method to convert a buffer to a point on the BabyJub curve described in [2.3.2].</li>
<li>Multiply the point by 8. The result is the point with x-value <code class="language-math math-inline">A_{b_x}</code> and y-value <code class="language-math math-inline">A_{b_y}</code></li>
</ol>
<p>Given the <a href="https://wstein.org/edu/2007/spring/ent/ent-html/node89.html" target="_blank" rel="noopener noreferrer">elliptic curve discrete logarithm problem</a>, we assume that no-one knows the private key <code class="language-math math-inline">s \in {F}_p</code> and by using the public key generation procedure in [1.4], we can derive <code class="language-math math-inline">A_{b_x}</code> and <code class="language-math math-inline">A_{b_y}</code>. Furthermore, the string above (<code>PedersenGenerator...</code>) acts as a nothing-up-my-sleeve value.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/v1.x/primitives.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/maci/docs/v1.x/introduction"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Introduction</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/maci/docs/v1.x/installation"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Installation</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#maci-primitives" class="table-of-contents__link toc-highlight">MACI primitives</a><ul><li><a href="#elliptic-curves" class="table-of-contents__link toc-highlight">Elliptic Curves</a></li><li><a href="#key-pairs" class="table-of-contents__link toc-highlight">Key Pairs</a></li><li><a href="#message-signing" class="table-of-contents__link toc-highlight">Message Signing</a></li><li><a href="#hash-functions" class="table-of-contents__link toc-highlight">Hash Functions</a></li><li><a href="#message-encryption" class="table-of-contents__link toc-highlight">Message Encryption</a></li><li><a href="#shared-key-generation" class="table-of-contents__link toc-highlight">Shared Key Generation</a></li><li><a href="#merkle-trees" class="table-of-contents__link toc-highlight">Merkle Trees</a></li><li><a href="#domain-objects" class="table-of-contents__link toc-highlight">Domain Objects</a></li><li><a href="#ballot" class="table-of-contents__link toc-highlight">Ballot</a></li><li><a href="#state-leaf" class="table-of-contents__link toc-highlight">State leaf</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/maci/docs/v1.x/introduction">Documentation</a></li><li class="footer__item"><a href="https://github.com/privacy-scaling-explorations/maci" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.com/invite/sF5CT5rzrR" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/zkMACI" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/maci/blog">Blog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Privacy and Scaling Explorations</div></div></div></footer></div>
</body>
</html>