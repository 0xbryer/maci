"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[2906],{6792:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>r,metadata:()=>c,toc:()=>t});var s=a(5893),i=a(1151);const r={title:"MACI Command-line interface (CLI)",description:"Introduction to the MACI CLI interface that allows for effective deployment and testing",sidebar_label:"Command-line interface",sidebar_position:4},d="Command-line interface",c={id:"v1.x/cli",title:"MACI Command-line interface (CLI)",description:"Introduction to the MACI CLI interface that allows for effective deployment and testing",source:"@site/docs/v1.x/cli.md",sourceDirName:"v1.x",slug:"/v1.x/cli",permalink:"/maci/docs/v1.x/cli",draft:!1,unlisted:!1,editUrl:"https://github.com/privacy-scaling-explorations/maci/edit/dev/website/docs/v1.x/cli.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{title:"MACI Command-line interface (CLI)",description:"Introduction to the MACI CLI interface that allows for effective deployment and testing",sidebar_label:"Command-line interface",sidebar_position:4},sidebar:"docSidebar",previous:{title:"Primitives",permalink:"/maci/docs/v1.x/primitives"},next:{title:"Smart Contracts",permalink:"/maci/docs/v1.x/contracts"}},o={},t=[{value:"Subcommands",id:"subcommands",level:2},{value:"Public and private key format",id:"public-and-private-key-format",level:2},{value:"Coordinator: Deploy VkRegistry",id:"coordinator-deploy-vkregistry",level:3},{value:"Coordinator: Set verifying keys",id:"coordinator-set-verifying-keys",level:3},{value:"Coordinator: Create MACI instance",id:"coordinator-create-maci-instance",level:3},{value:"Coordinator: Deploy poll",id:"coordinator-deploy-poll",level:3},{value:"User: sign up",id:"user-sign-up",level:3},{value:"User: publish message",id:"user-publish-message",level:3},{value:"Coordinator: merge state tree",id:"coordinator-merge-state-tree",level:3},{value:"Coordinator: merge message tree",id:"coordinator-merge-message-tree",level:3},{value:"Coordinator: generate proofs",id:"coordinator-generate-proofs",level:3},{value:"Coordinator: prove on chain",id:"coordinator-prove-on-chain",level:3},{value:"Anyone: verify tally",id:"anyone-verify-tally",level:3},{value:"Demonstration",id:"demonstration",level:2},{value:"Scenario:",id:"scenario",level:3},{value:"Examples of serialized public and private keys:",id:"examples-of-serialized-public-and-private-keys",level:3},{value:"Coordinator: Deploy VkRegistry",id:"coordinator-deploy-vkregistry-1",level:3},{value:"Coordinator: Set verifying keys",id:"coordinator-set-verifying-keys-1",level:3},{value:"Coordinator: Create MACI instance",id:"coordinator-create-maci-instance-1",level:3},{value:"Coordinator: Deploy poll",id:"coordinator-deploy-poll-1",level:3},{value:"Alice: sign up",id:"alice-sign-up",level:3},{value:"Alice: votes for Party A (option index 0)",id:"alice-votes-for-party-a-option-index-0",level:3},{value:"Alice: submits an invalid vote for Party B (option index 1) with different public key",id:"alice-submits-an-invalid-vote-for-party-b-option-index-1-with-different-public-key",level:3},{value:"Coordinator: merge state tree",id:"coordinator-merge-state-tree-1",level:3},{value:"Coordinator: merge message tree",id:"coordinator-merge-message-tree-1",level:3},{value:"Coordinator: generate proofs",id:"coordinator-generate-proofs-1",level:3},{value:"Coordinator: prove on chain",id:"coordinator-prove-on-chain-1",level:3},{value:"Anyone: verify",id:"anyone-verify",level:3}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"command-line-interface",children:"Command-line interface"}),"\n",(0,s.jsxs)(n.p,{children:["MACI provides a command-line interface that allows for effective deployment and\ntesting. Applications that build on top of MACI, such as\n",(0,s.jsx)(n.a,{href:"https://clr.fund/",children:"clr.fund"}),", implement their own web UIs."]}),"\n",(0,s.jsxs)(n.p,{children:["Note that all the example commands default to a local Ethereum testnet at\n",(0,s.jsx)(n.code,{children:"http://localhost:8545"}),", and use the Ethereum private key\n",(0,s.jsx)(n.code,{children:"0xc87509a1c067bbde78beb793e6fa76530b6382a4c0241e5e4a9ec0a0f44dc0d3"}),". Do not\nsend any real funds to the address generated by this key."]}),"\n",(0,s.jsx)(n.p,{children:"For testing purposes, you can run:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# in maci/contracts\nnpm run hardhat\n"})}),"\n",(0,s.jsx)(n.h2,{id:"subcommands",children:"Subcommands"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Role"}),(0,s.jsx)(n.th,{children:"Action"}),(0,s.jsx)(n.th,{children:"Subcommand"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"User"}),(0,s.jsx)(n.td,{children:"Generate MACI keypair"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"genMaciKeypair"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"User"}),(0,s.jsx)(n.td,{children:"Generate MACI public key"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"genMaciPubkey"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Coordinator"}),(0,s.jsx)(n.td,{children:"Deploy VkRegistry"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"deployVkRegistry"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Coordinator"}),(0,s.jsx)(n.td,{children:"Set verifying keys"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"setVerifyingKeys"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Coordinator"}),(0,s.jsx)(n.td,{children:"Create MACI instance"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"create "})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Coordinator"}),(0,s.jsx)(n.td,{children:"Deploy a new poll"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"deployPoll"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Coordinator"}),(0,s.jsx)(n.td,{children:"Deploy a new poll processor and tallyer"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"deployPpt"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"User"}),(0,s.jsx)(n.td,{children:"Sign up"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"signup"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"User"}),(0,s.jsx)(n.td,{children:"Change key / vote"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"publish"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Coordinator"}),(0,s.jsx)(n.td,{children:"Merge state tree"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"mergeSignups"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Coordinator"}),(0,s.jsx)(n.td,{children:"Merge message tree"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"mergeMessages"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Coordinator"}),(0,s.jsx)(n.td,{children:"Generate message processing and vote tallying proofs"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"genProofs"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Coordinator"}),(0,s.jsx)(n.td,{children:"Submit proofs"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"proveOnChain"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Coordinator"}),(0,s.jsx)(n.td,{children:"Process and tally all votes without producing proofs"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"processAndTallyWithoutProofs"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Coordinator"}),(0,s.jsx)(n.td,{children:"Roll back message processing and vote tallying in the MACI contract"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"coordinatorReset"})})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"public-and-private-key-format",children:"Public and private key format"}),"\n",(0,s.jsxs)(n.p,{children:["MACI uses private keys in the BabyJub field for operations which occur within\nzk-SNARKs, such as decrypting messages or signing commands. As MACI is deployed\non Ethereum, we seek to avoid confusing BabyJub private keys with Ethereum\nprivate keys. To that end, users should pass serialized formats of public and\nprivate keys to this CLI. We use ",(0,s.jsx)(n.code,{children:"maci-domainobj"}),"'s ",(0,s.jsx)(n.code,{children:"PrivKey.serialize"})," and\n",(0,s.jsx)(n.code,{children:"PubKey.serialize"})," functions to do so."]}),"\n",(0,s.jsx)(n.p,{children:"Examples of serialized public and private keys:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Private key: macisk.49953af3585856f539d194b46c82f4ed54ec508fb9b882940cbe68bbc57e59e\nPublic key:  macipk.c974f4f168b79727ac98bfd53a65ea0b4e45dc2552fe73df9f8b51ebb0930330\n"})}),"\n",(0,s.jsx)(n.h3,{id:"coordinator-deploy-vkregistry",children:"Coordinator: Deploy VkRegistry"}),"\n",(0,s.jsxs)(n.p,{children:["This command deploys an instance of a VkRegistry contract. Multiple MACI\ncontracts can refer to the same VkRegistry as long as they are all owned (via\n",(0,s.jsx)(n.code,{children:"Ownable.sol"}),") by the same account."]}),"\n",(0,s.jsx)(n.p,{children:"Example usage:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"ETH_SK=0xc87509a1c067bbde78beb793e6fa76530b6382a4c0241e5e4a9ec0a0f44dc0d3 \\\nETH_PROVIDER=http://localhost:8545 \\\nnode build/index.js deployVkRegistry\n"})}),"\n",(0,s.jsx)(n.p,{children:"Example output:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"VkRegistry: 0x8CdaF0CD259887258Bc13a92C0a6dA92698644C0\n"})}),"\n",(0,s.jsx)(n.h3,{id:"coordinator-set-verifying-keys",children:"Coordinator: Set verifying keys"}),"\n",(0,s.jsxs)(n.p,{children:["Note that the filename of the ",(0,s.jsx)(n.code,{children:".zkey"})," files must follow this format:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"ProcessMessages_<STATE_TREE_DEPTH>-<MSG_TREE_DEPTH>-<MSG_SUBTREE_DEPTH>-<VOTE_OPTION_TREE_DEPTH>_test.<CONTRIBUTION_NUM>.zkey\nTallyVotes_<STATE_TREE_DEPTH>-<INT_STATE_TREE_DEPTH>-<VOTE_OPTION_TREE_DEPTH>>_test.<CONTRIBUTION_NUM>>.zkey\n"})}),"\n",(0,s.jsx)(n.p,{children:"Example usage:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"ETH_SK=0xc87509a1c067bbde78beb793e6fa76530b6382a4c0241e5e4a9ec0a0f44dc0d3 \\\nETH_PROVIDER=http://localhost:8545 \\\nnode build/index.js setVerifyingKeys \\\n    -s 10 -i 1 -m 2 -v 2 -b 1 \\\n    -p ./zkeys/ProcessMessages_10-2-1-2_test.0.zkey \\\n    -t ./zkeys/TallyVotes_10-1-2_test.0.zkey \\\n    -k 0x8CdaF0CD259887258Bc13a92C0a6dA92698644C0\n"})}),"\n",(0,s.jsx)(n.p,{children:"Example output:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Generating ./zkeys/ProcessMessages_10-2-1-2_test.0.zkey.vk.json, please wait...\nGenerating ./zkeys/TallyVotes_10-1-2_test.0.zkey.vk.json, please wait...\nTransaction hash: 0x582631c36a4e21e0b65c3f9100c6343408c8683a36ded36fc02a9be07fa079e8\n"})}),"\n",(0,s.jsx)(n.h3,{id:"coordinator-create-maci-instance",children:"Coordinator: Create MACI instance"}),"\n",(0,s.jsx)(n.p,{children:"Example usage:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"ETH_SK=0xc87509a1c067bbde78beb793e6fa76530b6382a4c0241e5e4a9ec0a0f44dc0d3 \\\nETH_PROVIDER=http://localhost:8545 \\\nnode build/index.js create -r 0x8CdaF0CD259887258Bc13a92C0a6dA92698644C0\n"})}),"\n",(0,s.jsx)(n.p,{children:"Example output:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Deploying InitialVoiceCreditProxy\nDeploying Poseidon contracts\nLinking Poseidon libraries to MACI\nLinking Poseidon libraries to PollFactory\nLinking Poseidon libraries to MessageAqFactory\nDeploying MACI\nTransferring PollFactory ownership to MACI\nTransferring MessageAqFactory ownership to PollFactory\nInitialising MACI\nMACI: 0x89962fa216d39fCcaaC11e1e462340d80ab6Cf4D\n"})}),"\n",(0,s.jsx)(n.h3,{id:"coordinator-deploy-poll",children:"Coordinator: Deploy poll"}),"\n",(0,s.jsx)(n.p,{children:"Example usage:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"ETH_SK=0xc87509a1c067bbde78beb793e6fa76530b6382a4c0241e5e4a9ec0a0f44dc0d3 \\\nETH_PROVIDER=http://localhost:8545 \\\nnode ./build/index.js deployPoll \\\n    -x 0x89962fa216d39fCcaaC11e1e462340d80ab6Cf4D \\\n    -pk macipk.c974f4f168b79727ac98bfd53a65ea0b4e45dc2552fe73df9f8b51ebb0930330 \\\n    -t 30 -g 25 -mv 25 -i 1 -m 2 -b 1 -v 2\n"})}),"\n",(0,s.jsx)(n.p,{children:"Example output:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Verifier: 0x5E70a420373D6BcB1ca3D08FEeB78a2F80727B29\nPoll ID: 0\nPoll contract: 0x710FA420C3bE4bb0730265d6581BDda11087A901\nPollProcessorAndTallyer contract: 0x62C3204a98bbbd73C8fc3B8bfCDa467CB079dF47\n"})}),"\n",(0,s.jsx)(n.h3,{id:"user-sign-up",children:"User: sign up"}),"\n",(0,s.jsx)(n.p,{children:"Example usage:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"ETH_SK=0xc87509a1c067bbde78beb793e6fa76530b6382a4c0241e5e4a9ec0a0f44dc0d3 \\\nETH_PROVIDER=http://localhost:8545 \\\nnode ./build/index.js signup \\\n    -p macipk.c974f4f168b79727ac98bfd53a65ea0b4e45dc2552fe73df9f8b51ebb0930330 \\\n    -x 0x89962fa216d39fCcaaC11e1e462340d80ab6Cf4D\n"})}),"\n",(0,s.jsx)(n.p,{children:"Example output:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Transaction hash: 0xcae04f618a0b45896732632121248c312cbc68584519c1e43932b110da9078bc\nState index: 1\n"})}),"\n",(0,s.jsx)(n.h3,{id:"user-publish-message",children:"User: publish message"}),"\n",(0,s.jsx)(n.p,{children:"Example usage:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"ETH_SK=0xc87509a1c067bbde78beb793e6fa76530b6382a4c0241e5e4a9ec0a0f44dc0d3 \\\nETH_PROVIDER=http://localhost:8545 \\\nnode build/index.js publish \\\n    -p macipk.c974f4f168b79727ac98bfd53a65ea0b4e45dc2552fe73df9f8b51ebb0930330 \\\n    -sk macisk.2ae4f199bf3925a2407f7c775c9261f351ab861d8e9ecbb84622bdd3f6d41b08 \\\n    -x 0x89962fa216d39fCcaaC11e1e462340d80ab6Cf4D \\\n    -i 1 -v 0 -w 9 -n 1 -o 0\n"})}),"\n",(0,s.jsx)(n.h3,{id:"coordinator-merge-state-tree",children:"Coordinator: merge state tree"}),"\n",(0,s.jsx)(n.p,{children:"Example usage:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"ETH_SK=0xc87509a1c067bbde78beb793e6fa76530b6382a4c0241e5e4a9ec0a0f44dc0d3 \\\nETH_PROVIDER=http://localhost:8545 \\\nnode build/index.js mergeSignups -x 0x89962fa216d39fCcaaC11e1e462340d80ab6Cf4D -o 0\n"})}),"\n",(0,s.jsx)(n.h3,{id:"coordinator-merge-message-tree",children:"Coordinator: merge message tree"}),"\n",(0,s.jsx)(n.p,{children:"Example usage:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"ETH_SK=0xc87509a1c067bbde78beb793e6fa76530b6382a4c0241e5e4a9ec0a0f44dc0d3 \\\nETH_PROVIDER=http://localhost:8545 \\\nnode build/index.js mergeMessages -x 0x89962fa216d39fCcaaC11e1e462340d80ab6Cf4D -o 0\n"})}),"\n",(0,s.jsx)(n.h3,{id:"coordinator-generate-proofs",children:"Coordinator: generate proofs"}),"\n",(0,s.jsx)(n.p,{children:"Example usage:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"node build/index.js genProofs -x 0x89962fa216d39fCcaaC11e1e462340d80ab6Cf4D \\\n    -sk macisk.49953af3585856f539d194b46c82f4ed54ec508fb9b882940cbe68bbc57e59e \\\n    -o 0 \\\n    -t tally.json \\\n    -f proofs.json \\\n    -r ~/rapidsnark/build/prover \\\n    -wp ./zkeys/ProcessMessages_10-2-1-2_test \\\n    -wt ./zkeys/TallyVotes_10-1-2_test \\\n    -zp ./zkeys/ProcessMessages_10-2-1-2_test.0.zkey \\\n    -zt ./zkeys/TallyVotes_10-1-2_test.0.zkey \\\n"})}),"\n",(0,s.jsx)(n.h3,{id:"coordinator-prove-on-chain",children:"Coordinator: prove on chain"}),"\n",(0,s.jsx)(n.p,{children:"Example usage:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"node build/index.js proveOnChain \\\n    -x 0x89962fa216d39fCcaaC11e1e462340d80ab6Cf4D \\\n    -o 0 \\\n    -q 0x62C3204a98bbbd73C8fc3B8bfCDa467CB079dF47 \\\n    -f proofs/\n"})}),"\n",(0,s.jsx)(n.h3,{id:"anyone-verify-tally",children:"Anyone: verify tally"}),"\n",(0,s.jsx)(n.p,{children:"Example usage:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"node build/index.js verify \\\n    -x 0xf204a4Ef082f5c04bB89F7D5E6568B796096735a \\\n    -o 0 \\\n    -t tally.json \\\n    -q 0x62C3204a98bbbd73C8fc3B8bfCDa467CB079dF47\n"})}),"\n",(0,s.jsx)(n.h2,{id:"demonstration",children:"Demonstration"}),"\n",(0,s.jsx)(n.h3,{id:"scenario",children:"Scenario:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Alice votes for Party A"}),"\n",(0,s.jsx)(n.li,{children:"Alice changes her key"}),"\n",(0,s.jsx)(n.li,{children:"Eve tries to bribe Alice to change her vote to Party B"}),"\n",(0,s.jsx)(n.li,{children:"Alice submits an invalid vote for Party B"}),"\n",(0,s.jsx)(n.li,{children:"The coordinator processes the votes, computes, and verifies the final tally"}),"\n",(0,s.jsx)(n.li,{children:"The expected result is: Party A has some votes and Party B has 0 votes."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Implication: Alice's invalid vote was not counted, and Eve had no way to tell."}),"\n",(0,s.jsx)(n.h3,{id:"examples-of-serialized-public-and-private-keys",children:"Examples of serialized public and private keys:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Coordinator:\nPrivate key: macisk.49953af3585856f539d194b46c82f4ed54ec508fb9b882940cbe68bbc57e59e\nPublic key:  macipk.c974f4f168b79727ac98bfd53a65ea0b4e45dc2552fe73df9f8b51ebb0930330\n\nAlice:\nPrivate key: macisk.fd7aa614ec4a82716ffc219c24fd7e7b52a2b63b5afb17e81c22fe21515539c\nPublic key:  macipk.3e7bb2d7f0a1b7e980f1b6f363d1e3b7a12b9ae354c2cd60a9cfa9fd12917391\n"})}),"\n",(0,s.jsx)(n.h3,{id:"coordinator-deploy-vkregistry-1",children:"Coordinator: Deploy VkRegistry"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"node build/index.js deployVkRegistry\n"})}),"\n",(0,s.jsx)(n.p,{children:"Output:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"VkRegistry: 0x8CdaF0CD259887258Bc13a92C0a6dA92698644C0\n"})}),"\n",(0,s.jsx)(n.h3,{id:"coordinator-set-verifying-keys-1",children:"Coordinator: Set verifying keys"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"node build/index.js setVerifyingKeys \\\n    --vk_registry 0x8CdaF0CD259887258Bc13a92C0a6dA92698644C0 \\\n    --state-tree-depth 10 \\\n    --int-state-tree-depth 1 \\\n    --msg-tree-depth 2 \\\n    --vote-option-tree-depth 2 \\\n    --msg-batch-depth 1 \\\n    --process-messages-zkey ./zkeys/ProcessMessages_10-2-1-2_test.0.zkey \\\n    --tally-votes-zkey ./zkeys/TallyVotes_10-1-2_test.0.zkey\n"})}),"\n",(0,s.jsx)(n.p,{children:"Output:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"Setting verifying keys...\nTransaction hash: 0x16236fe5e124f3d0c33ddf20a37ceba9730a659630258a1e858b3e335e057b8e\n"})}),"\n",(0,s.jsx)(n.h3,{id:"coordinator-create-maci-instance-1",children:"Coordinator: Create MACI instance"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"node build/index.js create \\\n    --vk-registry 0x8CdaF0CD259887258Bc13a92C0a6dA92698644C0\n"})}),"\n",(0,s.jsx)(n.p,{children:"Output:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"Deploying InitialVoiceCreditProxy\nDeploying Poseidon contracts\nLinking Poseidon libraries to MACI\nLinking Poseidon libraries to PollFactory\nLinking Poseidon libraries to MessageAqFactory\nDeploying MACI\nTransferring PollFactory ownership to MACI\nTransferring MessageAqFactory ownership to PollFactory\nInitialising MACI\nMACI: 0xf204a4Ef082f5c04bB89F7D5E6568B796096735a\n"})}),"\n",(0,s.jsx)(n.h3,{id:"coordinator-deploy-poll-1",children:"Coordinator: Deploy poll"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"node ./build/index.js deployPoll \\\n    --maci-address 0xf204a4Ef082f5c04bB89F7D5E6568B796096735a \\\n    --pubkey macipk.c974f4f168b79727ac98bfd53a65ea0b4e45dc2552fe73df9f8b51ebb0930330 \\\n    --duration 1000 \\\n    --max-messages 25 \\\n    --max-vote-options 25 \\\n    --int-state-tree-depth 1 \\\n    --msg-tree-depth 2 \\\n    --msg_batch_depth 1 \\\n    --vote-option-tree-depth 2\n"})}),"\n",(0,s.jsx)(n.p,{children:"Output:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"Verifier: 0x0d8cc4b8d15D4c3eF1d70af0071376fb26B5669b\nPoll ID: 0\nPoll contract: 0x08e8f54262de52fe7Dfd0Bc0C9Ea87689d70e985\nPollProcessorAndTallyer contract: 0xEcFcaB0A285d3380E488A39B4BB21e777f8A4EaC\n"})}),"\n",(0,s.jsx)(n.h3,{id:"alice-sign-up",children:"Alice: sign up"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"node ./build/index.js signup \\\n    --pubkey macipk.3e7bb2d7f0a1b7e980f1b6f363d1e3b7a12b9ae354c2cd60a9cfa9fd12917391 \\\n    --contract 0xf204a4Ef082f5c04bB89F7D5E6568B796096735a\n"})}),"\n",(0,s.jsx)(n.p,{children:"Output:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"Transaction hash: 0xcdff1e0cd3021cdc3ba2c65cfd74bac3715c32efdd2052c0e8f3a677a81a758b\nState index: 1\n"})}),"\n",(0,s.jsx)(n.h3,{id:"alice-votes-for-party-a-option-index-0",children:"Alice: votes for Party A (option index 0)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"node build/index.js publish \\\n    --pubkey macipk.3e7bb2d7f0a1b7e980f1b6f363d1e3b7a12b9ae354c2cd60a9cfa9fd12917391 \\\n    --privkey macisk.fd7aa614ec4a82716ffc219c24fd7e7b52a2b63b5afb17e81c22fe21515539c \\\n    --contract 0xf204a4Ef082f5c04bB89F7D5E6568B796096735a \\\n    --state-index 1 \\\n    --vote-option-index 0 \\\n    --new-vote-weight 9 \\\n    --nonce 1 \\\n    --poll-id 0\n"})}),"\n",(0,s.jsx)(n.p,{children:"Output:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"Transaction hash: 0xc0964069834b171bb698ffc61e31e1be456c740ff1967ccad7d8cd8ed362e545\nEphemeral private key: macisk.1bf4bba7086c213606bb4a775b1ceaa4c2e7119c329748e675375f0d79c900dc\n"})}),"\n",(0,s.jsx)(n.h3,{id:"alice-submits-an-invalid-vote-for-party-b-option-index-1-with-different-public-key",children:"Alice: submits an invalid vote for Party B (option index 1) with different public key"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"node build/index.js publish \\\n    --pubkey macipk.d5788ea6ccf1ec295df99aaef859031fe7bd359e7e03acb80eb6e8a192f2ce19 \\\n    --privkey macisk.fd7aa614ec4a82716ffc219c24fd7e7b52a2b63b5afb17e81c22fe21515539c \\\n    --contract 0xf204a4Ef082f5c04bB89F7D5E6568B796096735a \\\n    --state-index 1 \\\n    --vote-option-index 1 \\\n    --new-vote-weight 9 \\\n    --nonce 2 \\\n    --poll-id 0\n"})}),"\n",(0,s.jsx)(n.p,{children:"Output:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"Transaction hash: 0xc13b97e23b387d8c160e0f8b1bfb33dc0ff4441fe63a37f0fc3ec84a0cfa0600\nEphemeral private key: macisk.5bc9f217a29c5defad1ca9be3d649add1eca30037589527476e8335b24cf75b\n"})}),"\n",(0,s.jsx)(n.p,{children:"Time Travel"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"node build timeTravel -s 1000\n"})}),"\n",(0,s.jsx)(n.h3,{id:"coordinator-merge-state-tree-1",children:"Coordinator: merge state tree"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"node build/index.js mergeSignups \\\n    --contract 0xf204a4Ef082f5c04bB89F7D5E6568B796096735a \\\n    --poll-id 0\n"})}),"\n",(0,s.jsx)(n.p,{children:"Output:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"Merging state subroots 1 / 1\nExecuted mergeMaciStateAqSubRoots(); gas used: 723525\nTransaction hash: 0x14621b208fdadbf277edf80b393f1a9694099ae9676903e148fa485eecfadd4b\n\nAll state subtrees have been merged.\nMerging subroots to a main state root...\nExecuted mergeStateAq(); gas used: 1015876\nTransaction hash: 0xf2903b1c3c83b87c551a71f29e07762b464691ca58b0c6849b2f9b8f5783011f\nThe state tree has been merged.\n"})}),"\n",(0,s.jsx)(n.h3,{id:"coordinator-merge-message-tree-1",children:"Coordinator: merge message tree"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"node build/index.js mergeMessages \\\n    --contract 0xf204a4Ef082f5c04bB89F7D5E6568B796096735a \\\n    --poll-id 0\n"})}),"\n",(0,s.jsx)(n.p,{children:"Output:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"Merging message subroots 1 / 1\nExecuted mergeMaciStateAqSubRoots(); gas used: 604387\nTransaction hash: 0xe0c0306b80febe1f6947b6ccbefabef38d01abce0b7611f49ce1cc7e20f196a5\n\nAll message subtrees have been merged.\nMerging subroots to a main message root...\nExecuted mergeMessageAq(); gas used: 174376\nTransaction hash: 0x424581f08d5f8e9f4fd63b083f9446cc2bff3b8e4b67ebc834076d6e9c34ec20\nThe message tree has been merged.\n"})}),"\n",(0,s.jsx)(n.h3,{id:"coordinator-generate-proofs-1",children:"Coordinator: generate proofs"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"node build/index.js genProofs \\\n    --contract 0xf204a4Ef082f5c04bB89F7D5E6568B796096735a \\\n    --privkey macisk.49953af3585856f539d194b46c82f4ed54ec508fb9b882940cbe68bbc57e59e \\\n    --poll-id 0 \\\n    --tally-file tally.json \\\n    --output proofs \\\n    --rapidsnark ~/rapidsnark/build/prover \\\n    --process-witnessgen ./zkeys/ProcessMessages_10-2-1-2_test \\\n    --tally-witnessgen ./zkeys/TallyVotes_10-1-2_test \\\n    --process-zkey ./zkeys/ProcessMessages_10-2-1-2_test.0.zkey \\\n    --tally-zkey ./zkeys/TallyVotes_10-1-2_test.0.zkey\n"})}),"\n",(0,s.jsx)(n.p,{children:"Output:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"fromBlock = 0\nGenerating proofs of message processing...\n\nProgress: 1 / 1\n\nGenerating proofs of vote tallying...\n\nProgress: 1 / 1\n\nOK\n"})}),"\n",(0,s.jsx)(n.h3,{id:"coordinator-prove-on-chain-1",children:"Coordinator: prove on chain"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"node build/index.js proveOnChain \\\n    --contract 0xf204a4Ef082f5c04bB89F7D5E6568B796096735a \\\n    --poll-id 0 \\\n    --ppt 0xEcFcaB0A285d3380E488A39B4BB21e777f8A4EaC \\\n    --proof-dir proofs/\n"})}),"\n",(0,s.jsx)(n.p,{children:"Output:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"Submitting proofs of message processing...\nTransaction hash: 0x59388e69899612390ef22de235629e9355e14f888bb330b46511cc06d8f2035d\nProgress: 1 / 1\nAll message processing proofs have been submitted.\n\nSubmitting proofs of vote tallying...\nProgress: 1 / 1\nTransaction hash: 0xc90e3bd0618def86b709c995485271f806c60701a3f4246903498f27346b9f5e\nAll vote tallying proofs have been submitted.\n\nOK\n"})}),"\n",(0,s.jsx)(n.h3,{id:"anyone-verify",children:"Anyone: verify"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"node build/index.js verify \\\n    --contract 0xf204a4Ef082f5c04bB89F7D5E6568B796096735a \\\n    --poll-id 0 \\\n    --tally-file tally.json \\\n    --ppt 0xEcFcaB0A285d3380E488A39B4BB21e777f8A4EaC\n"})}),"\n",(0,s.jsx)(n.p,{children:"Output:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"{\n  provider: 'http://localhost:8545',\n  maci: '0xf204a4Ef082f5c04bB89F7D5E6568B796096735a',\n  pollId: 0,\n  newTallyCommitment: '0x29b47e79c10709047ba9788580c2dc8528f003eab42d30670df78a47b121aa6c',\n  results: {\n    tally: [\n      '9', '0', '0', '0', '0', '0',\n      '0', '0', '0', '0', '0', '0',\n      '0', '0', '0', '0', '0', '0',\n      '0', '0', '0', '0', '0', '0',\n      '0'\n    ],\n    salt: '0x132065c8ad3968008aeb7c114a04de228fa5b3618743ad00f64ad3f773a2e4d2'\n  },\n  totalSpentVoiceCredits: {\n    spent: '81',\n    salt: '0x2940f93e085350a04f6ff85e1ebffbc391fc3498f1cb41ab47f8899dc9c6efc6'\n  },\n  perVOSpentVoiceCredits: {\n    tally: [\n      '81', '0', '0', '0', '0', '0',\n      '0',  '0', '0', '0', '0', '0',\n      '0',  '0', '0', '0', '0', '0',\n      '0',  '0', '0', '0', '0', '0',\n      '0'\n    ],\n    salt: '0x2db5c3d6b015f8e2ea1cf7ffed7a44af0db8a8c09a5077415c076b6ebcee0571'\n  }\n}\nOK\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},1151:(e,n,a)=>{a.d(n,{Z:()=>c,a:()=>d});var s=a(7294);const i={},r=s.createContext(i);function d(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);