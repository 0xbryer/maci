"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[1187],{9411:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>p,frontMatter:()=>i,metadata:()=>a,toc:()=>c});var s=t(5250),o=t(720);const i={title:"MACI Deployment",description:"MACI Smart Contracts deployment",sidebar_label:"MACI deployment",sidebar_position:24},r="MACI Deployment",a={id:"deployment",title:"MACI Deployment",description:"MACI Smart Contracts deployment",source:"@site/versioned_docs/version-v1.x/deployment.md",sourceDirName:".",slug:"/deployment",permalink:"/docs/deployment",draft:!1,unlisted:!1,editUrl:"https://github.com/privacy-scaling-explorations/maci/edit/dev/website/versioned_docs/version-v1.x/deployment.md",tags:[],version:"v1.x",sidebarPosition:24,frontMatter:{title:"MACI Deployment",description:"MACI Smart Contracts deployment",sidebar_label:"MACI deployment",sidebar_position:24},sidebar:"version-1.x/mySidebar",previous:{title:"MACI Project ideas",permalink:"/docs/project-ideas"},next:{title:"Solidity Docs",permalink:"/docs/solidity-docs/"}},l={},c=[{value:"MACI Deployment Steps",id:"maci-deployment-steps",level:2},{value:"Note on ZKey artifacts",id:"note-on-zkey-artifacts",level:3},{value:"Deployment using <code>maci-cli</code>",id:"deployment-using-maci-cli",level:3},{value:"Deployment using <code>maci-contracts</code> hardhat tasks",id:"deployment-using-maci-contracts-hardhat-tasks",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"maci-deployment",children:"MACI Deployment"}),"\n",(0,s.jsx)(n.p,{children:"Currently, it is possible to deploy MACI contracts in two ways:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["using the cli (",(0,s.jsx)(n.code,{children:"maci-cli"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:["using the hardhat tasks inside the ",(0,s.jsx)(n.code,{children:"maci-contracts"})," package"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"maci-deployment-steps",children:"MACI Deployment Steps"}),"\n",(0,s.jsx)(n.p,{children:"In order, these are the steps for contract deployment:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Deploy crypto (Hasher, Poseidon)"}),"\n",(0,s.jsx)(n.li,{children:"Deploy VK Registry"}),"\n",(0,s.jsx)(n.li,{children:"Set verification keys"}),"\n",(0,s.jsx)(n.li,{children:"Deploy VoiceCreditProxy"}),"\n",(0,s.jsx)(n.li,{children:"Deploy Gatekeeper"}),"\n",(0,s.jsx)(n.li,{children:"Deploy Verifier"}),"\n",(0,s.jsx)(n.li,{children:"Deploy Topup credit"}),"\n",(0,s.jsx)(n.li,{children:"Deploy MessageProcessorFactory, PollFactory, SubsidyFactory, TallyFactory"}),"\n",(0,s.jsx)(n.li,{children:"Deploy MACI, AccQueueQuinaryMaci"}),"\n",(0,s.jsx)(n.li,{children:"Deploy Poll, AccQueueQuinaryMaci, MessageProcessor, Tally and Subsidy (optional)"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"note-on-zkey-artifacts",children:"Note on ZKey artifacts"}),"\n",(0,s.jsxs)(n.p,{children:["For testing purposes, you can use the test zkeys and artifacts that you can download using ",(0,s.jsx)(n.code,{children:"pnpm download:test-zkeys"}),". For production use, you can download the most recent artifacts that have undergone a trusted setup. Please refer to the ",(0,s.jsx)(n.a,{href:"/docs/trusted-setup",children:"Trusted Setup"})," section for more information. To download those, please use ",(0,s.jsx)(n.code,{children:"pnpm download:ceremony-zkeys"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Please do not use test artifacts in production. If you do require zKeys configured for larger param sizes, please reach out to us if you will be using them in production and we'll discuss running a new ceremony for those parameters. To build new circuits artifacts for testing purposes, please refer to the ",(0,s.jsx)(n.a,{href:"/docs/installation/#configure-circomkit",children:"installation page"})," and to the ",(0,s.jsx)(n.a,{href:"/docs/circuits",children:"circuits"})," section."]}),"\n",(0,s.jsxs)(n.h3,{id:"deployment-using-maci-cli",children:["Deployment using ",(0,s.jsx)(n.code,{children:"maci-cli"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"maci-cli deployVkRegistry\nmaci-cli setVerifyingKeys \\\n    --state-tree-depth 10 \\\n    --int-state-tree-depth 1 \\\n    --msg-tree-depth 2 \\\n    --vote-option-tree-depth 2 \\\n    --msg-batch-depth 1 \\\n    --process-messages-zkey ./zkeys/ProcessMessages_10-2-1-2_test/ProcessMessages_10-2-1-2_test.0.zkey \\\n    --tally-votes-zkey ./zkeys/TallyVotes_10-1-2_test/TallyVotes_10-1-2_test.0.zkey\nmaci-cli create --stateTreeDepth 10 --use-quadratic-voting true\nmaci-cli deployPoll \\\n    --pubkey coordinator-public-key \\\n    --duration 300 \\\n    --int-state-tree-depth 1 \\\n    --msg-tree-depth 2 \\\n    --msg-batch-depth 1 \\\n    --vote-option-tree-depth 2 \\\n    --subsidy-enabled false\n"})}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:["For quadratic voting polls, you can use the ",(0,s.jsx)(n.code,{children:"--use-quadratic-voting true"})," flag when creating the MACI instance.\nFor non-quadratic voting polls, you can use the ",(0,s.jsx)(n.code,{children:"--use-quadratic-voting false"})," flag when creating the MACI instance."]})}),"\n",(0,s.jsxs)(n.h3,{id:"deployment-using-maci-contracts-hardhat-tasks",children:["Deployment using ",(0,s.jsx)(n.code,{children:"maci-contracts"})," hardhat tasks"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Take the ",(0,s.jsx)(n.code,{children:"deploy-config-example.json"})," file and copy it over to ",(0,s.jsx)(n.code,{children:"deploy-config.json"})]}),"\n",(0,s.jsx)(n.li,{children:"Update the fields as necessary:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "sepolia": {\n    "ConstantInitialVoiceCreditProxy": {\n      "deploy": true,\n      "amount": 99\n    },\n    "FreeForAllGatekeeper": {\n      "deploy": false\n    },\n    "EASGatekeeper": {\n      "deploy": true,\n      "easAddress": "0xC2679fBD37d54388Ce493F1DB75320D236e1815e",\n      "schema": "0xe2636f31239f7948afdd9a9c477048b7fc2a089c347af60e3aa1251e5bf63e5c",\n      "attester": "attester-address"\n    },\n    "MACI": {\n      "stateTreeDepth": 10,\n      "gatekeeper": "EASGatekeeper"\n    },\n    "VkRegistry": {\n      "stateTreeDepth": 10,\n      "intStateTreeDepth": 1,\n      "messageTreeDepth": 2,\n      "voteOptionTreeDepth": 2,\n      "messageBatchDepth": 1,\n      "processMessagesZkey": "../cli/zkeys/ProcessMessages_10-2-1-2_test/ProcessMessages_10-2-1-2_test.0.zkey",\n      "tallyVotesZkey": "../cli/zkeys/TallyVotes_10-1-2_test/TallyVotes_10-1-2_test.0.zkey"\n    },\n    "Poll": {\n      "pollDuration": 30,\n      "coordinatorPubkey": "macipk.ea638a3366ed91f2e955110888573861f7c0fc0bb5fb8b8dca9cd7a08d7d6b93",\n      "subsidyEnabled": false,\n      "useQuadraticVoting": true\n    }\n  }\n}\n'})}),"\n",(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsxs)(n.li,{children:["Fill the ",(0,s.jsx)(n.code,{children:".env"})," file with the appropriate data (you will find an example in the ",(0,s.jsx)(n.code,{children:".env.example"})," file:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"your mnemonic"}),"\n",(0,s.jsx)(n.li,{children:"an RPC key"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Run ",(0,s.jsx)(n.code,{children:"pnpm deploy"})," to deploy the contracts (you can specify the network by appending ",(0,s.jsx)(n.code,{children:":network"})," to the command, e.g. ",(0,s.jsx)(n.code,{children:"pnpm deploy:sepolia"})," - please refer to the available networks on the ",(0,s.jsx)(n.code,{children:"package.json"})," scripts section)"]}),"\n",(0,s.jsxs)(n.li,{children:["Run ",(0,s.jsx)(n.code,{children:"pnpm deploy-poll"})," to deploy your first Poll (you can specify the network by appending ",(0,s.jsx)(n.code,{children:":network"})," to the command, e.g. ",(0,s.jsx)(n.code,{children:"pnpm deploy-poll:sepolia"})," - please refer to the available networks on the ",(0,s.jsx)(n.code,{children:"package.json"})," scripts section)"]}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:["Should you wish to deploy on a different network, you will need to update the ",(0,s.jsx)(n.a,{href:"https://github.com/privacy-scaling-explorations/maci/blob/dev/contracts/tasks/helpers/constants.ts",children:"contracts/tasks/helpers/constants.ts"})," file."]})}),"\n",(0,s.jsxs)(n.ol,{start:"6",children:["\n",(0,s.jsxs)(n.li,{children:["You will find all of the deployed contracts addresses and configs in the ",(0,s.jsx)(n.code,{children:"deployed-contracts.json"})," file inside the contracts folder."]}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:["You can find more information on integration and usage in the ",(0,s.jsx)(n.a,{href:"/docs/integrating",children:"Integrating MACI"})," section."]})})]})}function p(e={}){const{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},720:(e,n,t)=>{t.d(n,{Z:()=>a,a:()=>r});var s=t(79);const o={},i=s.createContext(o);function r(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);