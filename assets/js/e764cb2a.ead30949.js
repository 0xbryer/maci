"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[5123],{5976:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>o});var r=n(5893),t=n(1151);const i={},d="MessageProcessor",a={id:"solidity-docs/MessageProcessor",title:"MessageProcessor",description:"_MessageProcessor is used to process messages published by signup users",source:"@site/versioned_docs/version-v1.x/solidity-docs/MessageProcessor.md",sourceDirName:"solidity-docs",slug:"/solidity-docs/MessageProcessor",permalink:"/docs/solidity-docs/MessageProcessor",draft:!1,unlisted:!1,editUrl:"https://github.com/privacy-scaling-explorations/maci/edit/dev/website/versioned_docs/version-v1.x/solidity-docs/MessageProcessor.md",tags:[],version:"v1.x",frontMatter:{},sidebar:"version-1.x/mySidebar",previous:{title:"MACI",permalink:"/docs/solidity-docs/MACI"},next:{title:"Params",permalink:"/docs/solidity-docs/Params"}},c={},o=[{value:"NoMoreMessages",id:"nomoremessages",level:3},{value:"StateAqNotMerged",id:"stateaqnotmerged",level:3},{value:"MessageAqNotMerged",id:"messageaqnotmerged",level:3},{value:"InvalidProcessMessageProof",id:"invalidprocessmessageproof",level:3},{value:"VkNotSet",id:"vknotset",level:3},{value:"MaxVoteOptionsTooLarge",id:"maxvoteoptionstoolarge",level:3},{value:"NumSignUpsTooLarge",id:"numsignupstoolarge",level:3},{value:"CurrentMessageBatchIndexTooLarge",id:"currentmessagebatchindextoolarge",level:3},{value:"BatchEndIndexTooLarge",id:"batchendindextoolarge",level:3},{value:"processingComplete",id:"processingcomplete",level:3},{value:"numBatchesProcessed",id:"numbatchesprocessed",level:3},{value:"currentMessageBatchIndex",id:"currentmessagebatchindex",level:3},{value:"sbCommitment",id:"sbcommitment",level:3},{value:"verifier",id:"verifier",level:3},{value:"constructor",id:"constructor",level:3},{value:"processMessages",id:"processmessages",level:3},{value:"Parameters",id:"parameters",level:4},{value:"verifyProcessProof",id:"verifyprocessproof",level:3},{value:"genProcessMessagesPublicInputHash",id:"genprocessmessagespublicinputhash",level:3},{value:"Parameters",id:"parameters-1",level:4},{value:"Return Values",id:"return-values",level:4},{value:"genProcessMessagesPackedVals",id:"genprocessmessagespackedvals",level:3},{value:"Parameters",id:"parameters-2",level:4},{value:"updateMessageProcessingData",id:"updatemessageprocessingdata",level:3},{value:"Parameters",id:"parameters-3",level:4}];function l(e){const s={code:"code",em:"em",h1:"h1",h3:"h3",h4:"h4",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,t.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.h1,{id:"messageprocessor",children:"MessageProcessor"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.em,{children:"MessageProcessor is used to process messages published by signup users\nit will process message by batch due to large size of messages\nafter it finishes processing, the sbCommitment will be used for Tally and Subsidy contracts"})}),"\n",(0,r.jsx)(s.h3,{id:"nomoremessages",children:"NoMoreMessages"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-solidity",children:"error NoMoreMessages()\n"})}),"\n",(0,r.jsx)(s.h3,{id:"stateaqnotmerged",children:"StateAqNotMerged"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-solidity",children:"error StateAqNotMerged()\n"})}),"\n",(0,r.jsx)(s.h3,{id:"messageaqnotmerged",children:"MessageAqNotMerged"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-solidity",children:"error MessageAqNotMerged()\n"})}),"\n",(0,r.jsx)(s.h3,{id:"invalidprocessmessageproof",children:"InvalidProcessMessageProof"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-solidity",children:"error InvalidProcessMessageProof()\n"})}),"\n",(0,r.jsx)(s.h3,{id:"vknotset",children:"VkNotSet"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-solidity",children:"error VkNotSet()\n"})}),"\n",(0,r.jsx)(s.h3,{id:"maxvoteoptionstoolarge",children:"MaxVoteOptionsTooLarge"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-solidity",children:"error MaxVoteOptionsTooLarge()\n"})}),"\n",(0,r.jsx)(s.h3,{id:"numsignupstoolarge",children:"NumSignUpsTooLarge"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-solidity",children:"error NumSignUpsTooLarge()\n"})}),"\n",(0,r.jsx)(s.h3,{id:"currentmessagebatchindextoolarge",children:"CurrentMessageBatchIndexTooLarge"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-solidity",children:"error CurrentMessageBatchIndexTooLarge()\n"})}),"\n",(0,r.jsx)(s.h3,{id:"batchendindextoolarge",children:"BatchEndIndexTooLarge"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-solidity",children:"error BatchEndIndexTooLarge()\n"})}),"\n",(0,r.jsx)(s.h3,{id:"processingcomplete",children:"processingComplete"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-solidity",children:"bool processingComplete\n"})}),"\n",(0,r.jsx)(s.p,{children:"Whether there are unprocessed messages left"}),"\n",(0,r.jsx)(s.h3,{id:"numbatchesprocessed",children:"numBatchesProcessed"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-solidity",children:"uint256 numBatchesProcessed\n"})}),"\n",(0,r.jsx)(s.p,{children:"The number of batches processed"}),"\n",(0,r.jsx)(s.h3,{id:"currentmessagebatchindex",children:"currentMessageBatchIndex"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-solidity",children:"uint256 currentMessageBatchIndex\n"})}),"\n",(0,r.jsx)(s.p,{children:"The current message batch index. When the coordinator runs\nprocessMessages(), this action relates to messages\ncurrentMessageBatchIndex to currentMessageBatchIndex + messageBatchSize."}),"\n",(0,r.jsx)(s.h3,{id:"sbcommitment",children:"sbCommitment"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-solidity",children:"uint256 sbCommitment\n"})}),"\n",(0,r.jsx)(s.p,{children:"The commitment to the state and ballot roots"}),"\n",(0,r.jsx)(s.h3,{id:"verifier",children:"verifier"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-solidity",children:"contract Verifier verifier\n"})}),"\n",(0,r.jsx)(s.h3,{id:"constructor",children:"constructor"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-solidity",children:"constructor(contract Verifier _verifier) public\n"})}),"\n",(0,r.jsx)(s.h3,{id:"processmessages",children:"processMessages"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-solidity",children:"function processMessages(contract Poll _poll, uint256 _newSbCommitment, uint256[8] _proof) external\n"})}),"\n",(0,r.jsx)(s.p,{children:"Update the Poll's currentSbCommitment if the proof is valid."}),"\n",(0,r.jsx)(s.h4,{id:"parameters",children:"Parameters"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Name"}),(0,r.jsx)(s.th,{children:"Type"}),(0,r.jsx)(s.th,{children:"Description"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"_poll"}),(0,r.jsx)(s.td,{children:"contract Poll"}),(0,r.jsx)(s.td,{children:"The poll to update"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"_newSbCommitment"}),(0,r.jsx)(s.td,{children:"uint256"}),(0,r.jsx)(s.td,{children:"The new state root and ballot root commitment                         after all messages are processed"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"_proof"}),(0,r.jsx)(s.td,{children:"uint256[8]"}),(0,r.jsx)(s.td,{children:"The zk-SNARK proof"})]})]})]}),"\n",(0,r.jsx)(s.h3,{id:"verifyprocessproof",children:"verifyProcessProof"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-solidity",children:"function verifyProcessProof(contract Poll _poll, uint256 _currentMessageBatchIndex, uint256 _messageRoot, uint256 _currentSbCommitment, uint256 _newSbCommitment, uint256[8] _proof) internal view returns (bool)\n"})}),"\n",(0,r.jsx)(s.h3,{id:"genprocessmessagespublicinputhash",children:"genProcessMessagesPublicInputHash"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-solidity",children:"function genProcessMessagesPublicInputHash(contract Poll _poll, uint256 _currentMessageBatchIndex, uint256 _messageRoot, uint256 _numSignUps, uint256 _currentSbCommitment, uint256 _newSbCommitment) public view returns (uint256)\n"})}),"\n",(0,r.jsx)(s.p,{children:"Returns the SHA256 hash of the packed values (see\ngenProcessMessagesPackedVals), the hash of the coordinator's public key,\nthe message root, and the commitment to the current state root and\nballot root. By passing the SHA256 hash of these values to the circuit\nas a single public input and the preimage as private inputs, we reduce\nits verification gas cost though the number of constraints will be\nhigher and proving time will be higher."}),"\n",(0,r.jsx)(s.h4,{id:"parameters-1",children:"Parameters"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Name"}),(0,r.jsx)(s.th,{children:"Type"}),(0,r.jsx)(s.th,{children:"Description"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"_poll"}),(0,r.jsx)(s.td,{children:"contract Poll"}),(0,r.jsx)(s.td,{})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"_currentMessageBatchIndex"}),(0,r.jsx)(s.td,{children:"uint256"}),(0,r.jsx)(s.td,{})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"_messageRoot"}),(0,r.jsx)(s.td,{children:"uint256"}),(0,r.jsx)(s.td,{})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"_numSignUps"}),(0,r.jsx)(s.td,{children:"uint256"}),(0,r.jsx)(s.td,{})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"_currentSbCommitment"}),(0,r.jsx)(s.td,{children:"uint256"}),(0,r.jsx)(s.td,{})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"_newSbCommitment"}),(0,r.jsx)(s.td,{children:"uint256"}),(0,r.jsx)(s.td,{})]})]})]}),"\n",(0,r.jsx)(s.h4,{id:"return-values",children:"Return Values"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Name"}),(0,r.jsx)(s.th,{children:"Type"}),(0,r.jsx)(s.th,{children:"Description"})]})}),(0,r.jsx)(s.tbody,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"[0]"}),(0,r.jsx)(s.td,{children:"uint256"}),(0,r.jsx)(s.td,{children:"returns the SHA256 hash of the packed values"})]})})]}),"\n",(0,r.jsx)(s.h3,{id:"genprocessmessagespackedvals",children:"genProcessMessagesPackedVals"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-solidity",children:"function genProcessMessagesPackedVals(contract Poll _poll, uint256 _currentMessageBatchIndex, uint256 _numSignUps) public view returns (uint256)\n"})}),"\n",(0,r.jsx)(s.p,{children:"One of the inputs to the ProcessMessages circuit is a 250-bit\nrepresentation of four 50-bit values. This function generates this\n250-bit value, which consists of the maximum number of vote options, the\nnumber of signups, the current message batch index, and the end index of\nthe current batch."}),"\n",(0,r.jsx)(s.h4,{id:"parameters-2",children:"Parameters"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Name"}),(0,r.jsx)(s.th,{children:"Type"}),(0,r.jsx)(s.th,{children:"Description"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"_poll"}),(0,r.jsx)(s.td,{children:"contract Poll"}),(0,r.jsx)(s.td,{})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"_currentMessageBatchIndex"}),(0,r.jsx)(s.td,{children:"uint256"}),(0,r.jsx)(s.td,{})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"_numSignUps"}),(0,r.jsx)(s.td,{children:"uint256"}),(0,r.jsx)(s.td,{})]})]})]}),"\n",(0,r.jsx)(s.h3,{id:"updatemessageprocessingdata",children:"updateMessageProcessingData"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-solidity",children:"function updateMessageProcessingData(uint256 _newSbCommitment, uint256 _currentMessageBatchIndex, bool _processingComplete) internal\n"})}),"\n",(0,r.jsx)(s.p,{children:"update message processing state variables"}),"\n",(0,r.jsx)(s.h4,{id:"parameters-3",children:"Parameters"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Name"}),(0,r.jsx)(s.th,{children:"Type"}),(0,r.jsx)(s.th,{children:"Description"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"_newSbCommitment"}),(0,r.jsx)(s.td,{children:"uint256"}),(0,r.jsx)(s.td,{})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"_currentMessageBatchIndex"}),(0,r.jsx)(s.td,{children:"uint256"}),(0,r.jsx)(s.td,{})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"_processingComplete"}),(0,r.jsx)(s.td,{children:"bool"}),(0,r.jsx)(s.td,{})]})]})]})]})}function h(e={}){const{wrapper:s}={...(0,t.a)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},1151:(e,s,n)=>{n.d(s,{Z:()=>a,a:()=>d});var r=n(7294);const t={},i=r.createContext(t);function d(e){const s=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),r.createElement(i.Provider,{value:s},e.children)}}}]);